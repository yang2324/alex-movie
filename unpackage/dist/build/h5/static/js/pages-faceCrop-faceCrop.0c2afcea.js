(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-faceCrop-faceCrop"],{2290:function(t,o,e){var a=e("a9f2");"string"===typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);var i=e("4f06").default;i("38579573",a,!0,{sourceMap:!1,shadowMode:!1})},"3d46":function(t,o,e){"use strict";e.r(o);var a=e("4937"),i=e.n(a);for(var n in a)"default"!==n&&function(t){e.d(o,t,(function(){return a[t]}))}(n);o["default"]=i.a},4937:function(t,o,e){"use strict";e("4160"),e("b64b"),e("159b"),Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var a,i,n,r,s,p,c,d,u,l,h,f=uni.getSystemInfoSync(),v=f.screenWidth,g=(f.pixelRatio,1),b=100,m=f.screenWidth,w={data:function(){return{imageSrc:"",isShowImg:!1,cropperInitW:v,cropperInitH:v,cropperW:v,cropperH:v,cropperL:0,cropperT:0,transL:0,transT:0,scaleP:0,imageW:0,imageH:0,cutL:0,cutT:0,cutB:v,cutR:"100%",qualityWidth:m,innerAspectRadio:g}},onLoad:function(t){var o=t.tempFilePath;this.imageSrc=o;var e=this.getGlobalUser("globalUser");this.globalUser=e},mounted:function(){this.loadImage()},methods:{setData:function(t){var o=this;Object.keys(t).forEach((function(e){o.$set(o.$data,e,t[e])}))},getImage:function(){var t=this;uni.chooseImage({success:function(o){t.setData({imageSrc:o.tempFilePaths[0]}),t.loadImage()}})},loadImage:function(){var t=this;uni.showLoading({title:"图片加载中..."}),uni.getImageInfo({src:t.imageSrc,success:function(o){u=o.width/o.height,u>=1?(l=v,h=v/u):(l=v*u,h=v);var e=l>h?l:h;if(b=e>b?b:e,u>=1){var a=Math.ceil((v/u-(v/u-b))/2),i=a,n=Math.ceil((v-v+b)/2),r=n;t.setData({cropperW:v,cropperH:v/u,cropperL:Math.ceil((v-v)/2),cropperT:Math.ceil((v-v/u)/2),cutL:n,cutT:a,cutR:r,cutB:i,imageW:l,imageH:h,scaleP:l/v,qualityWidth:m,innerAspectRadio:u})}else{var s=Math.ceil((v*u-v*u)/2),p=s,c=Math.ceil((v-b)/2),d=c;t.setData({cropperW:v*u,cropperH:v,cropperL:Math.ceil((v-v*u)/2),cropperT:Math.ceil((v-v)/2),cutL:s,cutT:c,cutR:p,cutB:d,imageW:l,imageH:h,scaleP:l/v,qualityWidth:m,innerAspectRadio:u})}t.setData({isShowImg:!0}),uni.hideLoading()}})},contentStartMove:function(t){a=t.touches[0].pageX,i=t.touches[0].pageY},contentMoveing:function(t){var o=(a-t.touches[0].pageX)*g,e=(i-t.touches[0].pageY)*g;o>0?this.cutL-o<0&&(o=this.cutL):this.cutR+o<0&&(o=-this.cutR),e>0?this.cutT-e<0&&(e=this.cutT):this.cutB+e<0&&(e=-this.cutB),this.setData({cutL:this.cutL-o,cutT:this.cutT-e,cutR:this.cutR+o,cutB:this.cutB+e}),a=t.touches[0].pageX,i=t.touches[0].pageY},contentTouchEnd:function(){},getImageInfo:function(){var t=this;uni.showLoading({title:"图片生成中..."});var o=uni.createCanvasContext("myCanvas");o.drawImage(t.imageSrc,0,0,l,h),o.draw(!0,(function(){var o=(t.cropperW-t.cutL-t.cutR)/t.cropperW*l,e=(t.cropperH-t.cutT-t.cutB)/t.cropperH*h,a=t.cutL/t.cropperW*l,i=t.cutT/t.cropperH*h;uni.canvasToTempFilePath({x:a,y:i,width:o,height:e,destWidth:o,destHeight:e,quality:.5,canvasId:"myCanvas",success:function(o){uni.hideLoading();var e=o.tempFilePath;uni.showLoading({mask:!0}),uni.uploadFile({url:t.serverUrl+"/user/uploadFace?userId="+t.globalUser.id+"&qq=2715705745",filePath:e,header:{headerUserId:t.globalUser.id,headerUserToken:t.globalUser.userUniqueToken},name:"file",success:function(t){var o=t.data,e=JSON.parse(o);if(200==e.status){uni.hideLoading();var a=e.data;uni.setStorageSync("globalUser",a),uni.navigateBack({delta:1})}else 500!=e.status&&502!=e.status||uni.showToast({title:t.data.msg,image:"../../static/icos/error.png",duration:2e3})},complete:function(){uni.hideLoading()}})}})}))},dragStart:function(t){n=t.touches[0].pageX,r=t.touches[0].pageY,s=this.cutL,c=this.cutR,d=this.cutB,p=this.cutT},dragMove:function(t){var o=t.target.dataset.drag;switch(o){case"right":var e=(n-t.touches[0].pageX)*g;c+e<0&&(e=-c),this.setData({cutR:c+e});break;case"left":e=(n-t.touches[0].pageX)*g;s-e<0&&(e=s),s-e>this.cropperW-this.cutR&&(e=s-(this.cropperW-this.cutR)),this.setData({cutL:s-e});break;case"top":e=(r-t.touches[0].pageY)*g;p-e<0&&(e=p),p-e>this.cropperH-this.cutB&&(e=p-(this.cropperH-this.cutB)),this.setData({cutT:p-e});break;case"bottom":e=(r-t.touches[0].pageY)*g;d+e<0&&(e=-d),this.setData({cutB:d+e});break;case"rightBottom":var a=(n-t.touches[0].pageX)*g,i=(r-t.touches[0].pageY)*g;d+i<0&&(i=-d),c+a<0&&(a=-c);var u=d+i,l=c+a;this.setData({cutB:u,cutR:l});break;default:break}}}};o.default=w},7607:function(t,o,e){"use strict";e.r(o);var a=e("b600"),i=e("3d46");for(var n in i)"default"!==n&&function(t){e.d(o,t,(function(){return i[t]}))}(n);e("f362");var r,s=e("f0c5"),p=Object(s["a"])(i["default"],a["b"],a["c"],!1,null,"b18d4ff2",null,!1,a["a"],r);o["default"]=p.exports},a9f2:function(t,o,e){var a=e("24fb");o=a(!1),o.push([t.i,'/* pages/uni-cropper/index.wxss */.uni-content-info[data-v-b18d4ff2]{\n\t\t/* position: fixed;\n\t\ttop: 0;\n\t\tleft: 0;\n\t\tright: 0;\n\t\tbottom: 0;\n\t\tdisplay: block;\n\t\talign-items: center;\n\t\tflex-direction: column; */}.cropper-config[data-v-b18d4ff2]{padding:%?20?% %?40?%}.cropper-content[data-v-b18d4ff2]{min-height:%?750?%;width:100%}.uni-corpper[data-v-b18d4ff2]{position:relative;overflow:hidden;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none;-webkit-box-sizing:border-box;box-sizing:border-box}.uni-corpper-content[data-v-b18d4ff2]{position:relative}.uni-corpper-content uni-image[data-v-b18d4ff2]{display:block;width:100%;min-width:0!important;max-width:none!important;height:100%;min-height:0!important;max-height:none!important;image-orientation:0deg!important;margin:0 auto}\n\n\t/* 移动图片效果 */.uni-cropper-drag-box[data-v-b18d4ff2]{position:absolute;top:0;right:0;bottom:0;left:0;cursor:move;background:rgba(0,0,0,.6);z-index:1}\n\n\t/* 内部的信息 */.uni-corpper-crop-box[data-v-b18d4ff2]{position:absolute;background:hsla(0,0%,100%,.3);z-index:2}.uni-corpper-crop-box .uni-cropper-view-box[data-v-b18d4ff2]{position:relative;display:block;width:100%;height:100%;overflow:visible;outline:%?1?% solid #69f;outline-color:rgba(102,153,255,.75)}\n\n\t/* 横向虚线 */.uni-cropper-dashed-h[data-v-b18d4ff2]{position:absolute;top:33.33333333%;left:0;width:100%;height:33.33333333%;border-top:%?1?% dashed hsla(0,0%,100%,.5);border-bottom:%?1?% dashed hsla(0,0%,100%,.5)}\n\n\t/* 纵向虚线 */.uni-cropper-dashed-v[data-v-b18d4ff2]{position:absolute;left:33.33333333%;top:0;width:33.33333333%;height:100%;border-left:%?1?% dashed hsla(0,0%,100%,.5);border-right:%?1?% dashed hsla(0,0%,100%,.5)}\n\n\t/* 四个方向的线  为了之后的拖动事件*/.uni-cropper-line-t[data-v-b18d4ff2]{position:absolute;display:block;width:100%;background-color:#69f;top:0;left:0;height:%?1?%;opacity:.1;cursor:n-resize}.uni-cropper-line-t[data-v-b18d4ff2]::before{content:"";position:absolute;top:50%;right:%?0?%;width:100%;-webkit-transform:translate3d(0,-50%,0);transform:translate3d(0,-50%,0);bottom:0;height:%?41?%;background:transparent;z-index:11}.uni-cropper-line-r[data-v-b18d4ff2]{position:absolute;display:block;background-color:#69f;top:0;right:%?0?%;width:%?1?%;opacity:.1;height:100%;cursor:e-resize}.uni-cropper-line-r[data-v-b18d4ff2]::before{content:"";position:absolute;top:0;left:50%;width:%?41?%;-webkit-transform:translate3d(-50%,0,0);transform:translate3d(-50%,0,0);bottom:0;height:100%;background:transparent;z-index:11}.uni-cropper-line-b[data-v-b18d4ff2]{position:absolute;display:block;width:100%;background-color:#69f;bottom:0;left:0;height:%?1?%;opacity:.1;cursor:s-resize}.uni-cropper-line-b[data-v-b18d4ff2]::before{content:"";position:absolute;top:50%;right:%?0?%;width:100%;-webkit-transform:translate3d(0,-50%,0);transform:translate3d(0,-50%,0);bottom:0;height:%?41?%;background:transparent;z-index:11}.uni-cropper-line-l[data-v-b18d4ff2]{position:absolute;display:block;background-color:#69f;top:0;left:0;width:%?1?%;opacity:.1;height:100%;cursor:w-resize}.uni-cropper-line-l[data-v-b18d4ff2]::before{content:"";position:absolute;top:0;left:50%;width:%?41?%;-webkit-transform:translate3d(-50%,0,0);transform:translate3d(-50%,0,0);bottom:0;height:100%;background:transparent;z-index:11}.uni-cropper-point[data-v-b18d4ff2]{width:%?5?%;height:%?5?%;background-color:#69f;opacity:.75;position:absolute;z-index:3}.point-t[data-v-b18d4ff2]{top:%?-3?%;left:50%;margin-left:%?-3?%;cursor:n-resize}.point-tr[data-v-b18d4ff2]{top:%?-3?%;left:100%;margin-left:%?-3?%;cursor:n-resize}.point-r[data-v-b18d4ff2]{top:50%;left:100%;margin-left:%?-3?%;margin-top:%?-3?%;cursor:n-resize}.point-rb[data-v-b18d4ff2]{left:100%;top:100%;-webkit-transform:translate3d(-50%,-50%,0);transform:translate3d(-50%,-50%,0);cursor:n-resize;width:%?36?%;height:%?36?%;background-color:#69f;position:absolute;z-index:1112;opacity:1}.point-b[data-v-b18d4ff2]{left:50%;top:100%;margin-left:%?-3?%;margin-top:%?-3?%;cursor:n-resize}.point-bl[data-v-b18d4ff2]{left:0;top:100%;margin-left:%?-3?%;margin-top:%?-3?%;cursor:n-resize}.point-l[data-v-b18d4ff2]{left:0;top:50%;margin-left:%?-3?%;margin-top:%?-3?%;cursor:n-resize}.point-lt[data-v-b18d4ff2]{left:0;top:0;margin-left:%?-3?%;margin-top:%?-3?%;cursor:n-resize}\n\n\t/* 裁剪框预览内容 */.uni-cropper-viewer[data-v-b18d4ff2]{position:relative;width:100%;height:100%;overflow:hidden}.uni-cropper-viewer uni-image[data-v-b18d4ff2]{position:absolute;z-index:2}\n\n\t/* 以下是我的补充css */\n\n\t/* 页面铺满屏幕 */.page-fill[data-v-b18d4ff2]{width:100%;height:100%;position:absolute;background:#000}.myDistance[data-v-b18d4ff2]{\n\t\t/* padding-top: 100upx */}\n\n\t/* 底部操作 start */.footer-opertor[data-v-b18d4ff2]{position:fixed;bottom:0;border-top:#515050 solid 1px;width:100%;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;padding:%?30?%}.opertor-words[data-v-b18d4ff2]{color:#e8e5e5;font-size:16px;width:%?200?%}\n\n\t/* 底部操作 end */',""]),t.exports=o},b600:function(t,o,e){"use strict";var a;e.d(o,"b",(function(){return i})),e.d(o,"c",(function(){return n})),e.d(o,"a",(function(){return a}));var i=function(){var t=this,o=t.$createElement,e=t._self._c||o;return e("v-uni-view",{staticClass:"page page-fill"},[e("v-uni-view",{staticClass:"page-body uni-content-info"},[e("v-uni-view",{staticClass:"cropper-content"},[t.isShowImg?e("v-uni-view",{staticClass:"uni-corpper myDistance",style:"width:"+t.cropperInitW+"px;height:"+t.cropperInitH+"px;background:#000"},[e("v-uni-view",{staticClass:"uni-corpper-content",style:"width:"+t.cropperW+"px;height:"+t.cropperH+"px;left:"+t.cropperL+"px;top:"+t.cropperT+"px"},[e("v-uni-image",{staticClass:"myImage",style:"width:"+t.cropperW+"px;height:"+t.cropperH+"px",attrs:{src:t.imageSrc}}),e("v-uni-view",{staticClass:"uni-corpper-crop-box",style:"left:"+t.cutL+"px;top:"+t.cutT+"px;right:"+t.cutR+"px;bottom:"+t.cutB+"px",on:{touchstart:function(o){o.stopPropagation(),arguments[0]=o=t.$handleEvent(o),t.contentStartMove.apply(void 0,arguments)},touchmove:function(o){o.stopPropagation(),arguments[0]=o=t.$handleEvent(o),t.contentMoveing.apply(void 0,arguments)},touchend:function(o){o.stopPropagation(),arguments[0]=o=t.$handleEvent(o),t.contentTouchEnd.apply(void 0,arguments)}}},[e("v-uni-view",{staticClass:"uni-cropper-view-box"},[e("v-uni-view",{staticClass:"uni-cropper-dashed-h"}),e("v-uni-view",{staticClass:"uni-cropper-dashed-v"}),e("v-uni-view",{staticClass:"uni-cropper-line-t",attrs:{"data-drag":"top"},on:{touchstart:function(o){o.stopPropagation(),arguments[0]=o=t.$handleEvent(o),t.dragStart.apply(void 0,arguments)},touchmove:function(o){o.stopPropagation(),arguments[0]=o=t.$handleEvent(o),t.dragMove.apply(void 0,arguments)}}}),e("v-uni-view",{staticClass:"uni-cropper-line-r",attrs:{"data-drag":"right"},on:{touchstart:function(o){o.stopPropagation(),arguments[0]=o=t.$handleEvent(o),t.dragStart.apply(void 0,arguments)},touchmove:function(o){o.stopPropagation(),arguments[0]=o=t.$handleEvent(o),t.dragMove.apply(void 0,arguments)}}}),e("v-uni-view",{staticClass:"uni-cropper-line-b",attrs:{"data-drag":"bottom"},on:{touchstart:function(o){o.stopPropagation(),arguments[0]=o=t.$handleEvent(o),t.dragStart.apply(void 0,arguments)},touchmove:function(o){o.stopPropagation(),arguments[0]=o=t.$handleEvent(o),t.dragMove.apply(void 0,arguments)}}}),e("v-uni-view",{staticClass:"uni-cropper-line-l",attrs:{"data-drag":"left"},on:{touchstart:function(o){o.stopPropagation(),arguments[0]=o=t.$handleEvent(o),t.dragStart.apply(void 0,arguments)},touchmove:function(o){o.stopPropagation(),arguments[0]=o=t.$handleEvent(o),t.dragMove.apply(void 0,arguments)}}}),e("v-uni-view",{staticClass:"uni-cropper-point point-t",attrs:{"data-drag":"top"},on:{touchstart:function(o){o.stopPropagation(),arguments[0]=o=t.$handleEvent(o),t.dragStart.apply(void 0,arguments)},touchmove:function(o){o.stopPropagation(),arguments[0]=o=t.$handleEvent(o),t.dragMove.apply(void 0,arguments)}}}),e("v-uni-view",{staticClass:"uni-cropper-point point-tr",attrs:{"data-drag":"topTight"}}),e("v-uni-view",{staticClass:"uni-cropper-point point-r",attrs:{"data-drag":"right"},on:{touchstart:function(o){o.stopPropagation(),arguments[0]=o=t.$handleEvent(o),t.dragStart.apply(void 0,arguments)},touchmove:function(o){o.stopPropagation(),arguments[0]=o=t.$handleEvent(o),t.dragMove.apply(void 0,arguments)}}}),e("v-uni-view",{staticClass:"uni-cropper-point point-rb",attrs:{"data-drag":"rightBottom"},on:{touchstart:function(o){o.stopPropagation(),arguments[0]=o=t.$handleEvent(o),t.dragStart.apply(void 0,arguments)},touchmove:function(o){o.stopPropagation(),arguments[0]=o=t.$handleEvent(o),t.dragMove.apply(void 0,arguments)}}}),e("v-uni-view",{staticClass:"uni-cropper-point point-b",attrs:{"data-drag":"bottom"},on:{touchstart:function(o){o.stopPropagation(),arguments[0]=o=t.$handleEvent(o),t.dragStart.apply(void 0,arguments)},touchmove:function(o){o.stopPropagation(),arguments[0]=o=t.$handleEvent(o),t.dragMove.apply(void 0,arguments)},touchend:function(o){o.stopPropagation(),arguments[0]=o=t.$handleEvent(o),t.dragEnd.apply(void 0,arguments)}}}),e("v-uni-view",{staticClass:"uni-cropper-point point-bl",attrs:{"data-drag":"bottomLeft"}}),e("v-uni-view",{staticClass:"uni-cropper-point point-l",attrs:{"data-drag":"left"},on:{touchstart:function(o){o.stopPropagation(),arguments[0]=o=t.$handleEvent(o),t.dragStart.apply(void 0,arguments)},touchmove:function(o){o.stopPropagation(),arguments[0]=o=t.$handleEvent(o),t.dragMove.apply(void 0,arguments)}}}),e("v-uni-view",{staticClass:"uni-cropper-point point-lt",attrs:{"data-drag":"leftTop"}})],1)],1)],1)],1):t._e()],1),e("v-uni-view",{staticClass:"footer-opertor"},[e("v-uni-view",{staticClass:"opertor-words",on:{click:function(o){arguments[0]=o=t.$handleEvent(o),t.getImage.apply(void 0,arguments)}}},[t._v("重新选择")]),e("v-uni-view",{staticClass:"opertor-words",on:{click:function(o){arguments[0]=o=t.$handleEvent(o),t.getImageInfo.apply(void 0,arguments)}}},[t._v("确认上传")])],1),e("v-uni-canvas",{style:"position:absolute;border: 1px solid red; width:"+t.imageW+"px;height:"+t.imageH+"px;top:-9999px;left:-9999px;",attrs:{"canvas-id":"myCanvas"}})],1)],1)},n=[]},f362:function(t,o,e){"use strict";var a=e("2290"),i=e.n(a);i.a}}]);